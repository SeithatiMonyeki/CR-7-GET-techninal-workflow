---
title: "Red List Index of ecosystems assessments"
subtitle: "Summary Findings"

date: last-modified
date-format: DD-MM-YYYY
---

```{r setup}
#| echo: false
#| message: false
#| warning: false


library(nbaR)
library(dplyr)
library(tidyr)
#library(stringi)
library(rlang)
library(gt)
library(ggplot2)
library(RColorBrewer)
library(here)

```

```{r, echo=FALSE}

RLIe_GET_L2 <- readxl::read_xlsx("./data/RLIe_GET_L2.xlsx")
RLIe_GET_L3 <- readxl::read_xlsx("./data/RLIe_GET_L3.xlsx")
RLIe_national <- readxl::read_xlsx("./data/RLIe_national.xlsx")

GET_L2.count <- readxl::read_xlsx("./data/GET_L2.count.xlsx")
GET_L3.count <- readxl::read_xlsx("./data/GET_L3.count.xlsx")

GET_L2.ecosytems_count <- readxl::read_xlsx("./data/GET_L2.ecosytems_count.xlsx")
GET_L3.ecosytems_count <- readxl::read_xlsx("./data/GET_L3.ecosytems_count.xlsx")
```

## Overview

South Africa is among the first countries to apply the Red List Index of Ecosystems (RLIe). To date, national trends have been assessed only for terrestrial ecosystems, with plans to expand the assessment in the near future to include ecosystems across all realms. In parallel with the RLIe application, South Africa has made substantial progress in crosswalking its national ecosystem classification across realms to the IUCN Global Ecosystem Typology (GET). The IUCN Global Ecosystem Typology is a global, hierarchical classification system designed to consistently describe ecosystems, thereby enabling comparability of ecosystem assessments across regions, realms, and spatial scales.

Many of South Africa’s ecosystems are nested within higher-level functional units of the GET, specifically Level 2 (functional biomes) and Level 3 (ecosystem functional groups). These levels were used as the primary analytical and reporting units to ensure a consistent application of the RLIe indicator across terrestrial ecosystems. In total, South Africa’s 463 terrestrial ecosystem types were matched to five GET Level 2 functional biomes, while the crosswalk to GET Level 3 resulted in 11 ecosystem functional groups.

The Red List Index of Ecosystems (RLIe) was calculated at both GET Level 2 and GET Level 3 across four assessment periods (2014, 2018, 2022, and 2024). The index ranges from 0 to 1, where a value of 0 indicates that all ecosystems within a given functional biome or ecosystem functional group have collapsed, and a value of 1 indicates that all ecosystems are classified as Least Concern. Importantly, an RLIe value of 1 does not imply the absence of threats; rather, it reflects that the cumulative impacts of ongoing pressures have not yet reached the thresholds required to trigger threat categories under the IUCN Red List of Ecosystems criteria.

## Global Ecosystem Typology at Level 2

```{r, echo=FALSE, fig.width=9, fig.height=4.5}
#| label: fig-1
#| fig-cap: "Red List Index of Ecosystems (RLIe) assessed at IUCN Global Ecosystem Typology (GET) Level 2 for South Africa. Changes in the slope of each line indicate the rate at which ecosystem functional groups within each GET Level 2 category are becoming more threatened over time. Lower RLIe values indicate movement towards ecosystem collapse (an RLIe value of 0 indicates complete ecosystem collapse). The aggregate line represents the national mean RLIe across all assessed GET Level 2 categories."

# ---- GET_L2 ----
getL2_levels <- unique(RLIe_GET_L2$GET)
getL2_colors <- setNames(brewer.pal(n = length(getL2_levels), name = "Paired"), getL2_levels)

GET_L2.plot <- ggplot() +
  
  geom_line(data = RLIe_GET_L2,
            aes(x = Year, y = RLIE, color = GET),
            size = 0.7) +
  
  geom_point(data = RLIe_GET_L2,
             aes(x = Year, y = RLIE, color = GET),
             size = 3) +
  
  # Aggregate (national)
  geom_line(data = RLIe_national,
            aes(x = Year, linetype = "Aggregate", shape = "Aggregate", y = RLIE),
            color = "black",
            size = 0.7) +
  
  geom_point(data = RLIe_national,
             aes(x = Year, y = RLIE, shape = "Aggregate"),
             color = "black",
             size = 3) +
  
  # Scales
  scale_color_manual(name = "IUCN Global Ecosystem Typology (Level 2)", values = getL2_colors) +
  scale_linetype_manual(name = "", values = c("Aggregate" = "dotted"), guide = guide_legend(order = 2)) +
  scale_shape_manual(name = "", values = c("Aggregate" = 20), guide = guide_legend(order = 2)) +
  scale_x_continuous(breaks = unique(RLIe_GET_L2$Year)) +
  scale_y_continuous(limits = c(0.4, 1), breaks = seq(0.5, 1, 0.1)) +
  
  # Labels
  labs(x = "Year", y = "Red List Index of ecosystems") +
  
  # Theme
  theme_classic() +
  theme(legend.position = "right",
        legend.box = "vertical",
        legend.text = element_text(size = 8.5),
        legend.title = element_text(size = 10, lineheight = 1.3, margin = margin(b = 7)),
        legend.spacing.y = unit(0.4, 'cm'),
        legend.key.size = unit(0.6, "cm"),
        axis.title.x = element_text(size = 10, margin = margin(t = 12)),
        axis.title.y = element_text(size = 10, margin = margin(r = 12)),
        axis.text = element_text(size = 8.5))

print(GET_L2.plot)

ggsave(filename = "GET_L2.plot.png",
       plot = GET_L2.plot,
       path = "./images",
       width = 45,
       height = 30,
       dpi = 300)
```

A pattern broadly consistent with biome-level trends reported in the NBA 2025 is also evident across the GET Level 2 functional biomes. T2: Temperate–boreal forests and woodlands have maintained a high level of resilience to pressures, with an RLIe score of 1.0 across all four assessment periods. This stability indicates no detectable deterioration at this level, as all four ecosystems within this functional biome remained classified as Least Concern throughout the assessment timeframe. However, this does not imply an absence of underlying pressures.

Ecosystems classified within T5: Deserts and semi-deserts and T1: Tropical–subtropical forests show modest declines in RLIe, reflecting incremental increases in ecosystem risk rather than abrupt shifts into higher threat categories. In contrast, among the five functional biomes assessed, MT2: Supralittoral coastal systems exhibit the most pronounced decline, indicating increasing vulnerability over the assessment period.

## Global Ecosystem Typology at Level 3


```{r, echo=FALSE, fig.width=10, fig.height=4.5}
#| label: fig-2
#| fig-cap: "Red List Index of Ecosystems (RLIe) assessed at IUCN Global Ecosystem Typology (GET) Level 3 for South Africa. Changes in the slope of each line indicate the rate at which ecosystem functional groups within each GET Level 3 category are becoming more threatened over time. Lower RLIe values indicate movement towards ecosystem collapse (an RLIe value of 0 indicates complete ecosystem collapse). The aggregate line represents the national mean RLIe across all assessed GET Level 3 categories."
#| 
# ---- Color Palette ----
unique_GETs <- unique(RLIe_GET_L3$GET)
get_colors <- setNames(brewer.pal(n = length(unique_GETs), name = "Paired"),unique_GETs)

# ---- GET_L3 ----

GET_L3.plot <- ggplot() +
  
  geom_line(data = RLIe_GET_L3,
            aes(x = Year, y = RLIE, color = GET),
            size = 0.7) +
  
  geom_point(data = RLIe_GET_L3,
             aes(x = Year, y = RLIE, color = GET),
             size = 3) +
  
  # Aggregate (national)
  geom_line(data = RLIe_national,
            aes(x = Year, linetype = "Aggregate", shape = "Aggregate", y = RLIE),
            color = "black",
            size = 0.7) +
  
  geom_point(data = RLIe_national,
             aes(x = Year, y = RLIE, shape = "Aggregate"),
             color = "black",
             size = 3) +
  
  # Scales
  scale_color_manual(name = "IUCN Global Ecosystem Typology (Level 3)", values = get_colors) +
  scale_linetype_manual(name = "", values = c("Aggregate" = "dotted"), guide = guide_legend(order = 2)) +
  scale_shape_manual(name = "", values = c("Aggregate" = 20), guide = guide_legend(order = 2)) +
  scale_x_continuous(breaks = unique(RLIe_GET_L3$Year)) +
  scale_y_continuous(limits = c(0.4, 1), breaks = seq(0.5, 1, 0.1)) +
  
  # Labels
  labs(x = "Year", y = "Red List Index of ecosystems") +
  
  # Theme
  theme_classic() +
  theme(legend.position = "right",
        legend.box = "vertical",
        legend.text = element_text(size = 9),
        legend.title = element_text(size = 10, lineheight = 1.3, margin = margin(b = 7)),
        legend.spacing.y = unit(0.4, 'cm'),
        legend.key.size = unit(0.6, "cm"),
        axis.title.x = element_text(size = 10, margin = margin(t = 12)),
        axis.title.y = element_text(size = 10, margin = margin(r = 12)),
        axis.text = element_text(size = 8.5))

print(GET_L3.plot)

ggsave(filename = "GET_L3.plot.png",
       plot = GET_L3.plot,
       path = "./images",
       width = 45,
       height = 30,
       dpi = 300)
```

At IUCN GET Level 3, ecosystem functional groups show a mixed pattern of resilience and vulnerability across assessment periods. Three of the eleven groups (T2.4 Warm temperate laurophyll forests, T3.1 Seasonally dry tropical shrublands, and T5.1 Semi-desert steppes) maintained an RLIe score of 1.0 throughout, indicating minimal detectable impacts from anthropogenic land-use pressures. In contrast, MT2.1 Coastal shrublands and grasslands showed the sharpest decline between 2014 and 2018 (to 0.6) before stabilising, while T3.2 Seasonally dry temperate heaths and shrublands declined prior to 2014 and remained stable thereafter at the same level. 

Overall, the aggregate RLIe declined slightly from 0.82 to 0.79 between 2014 and 2024, signalling a gradual increase in ecosystem threat. These contrasting trajectories highlight the need for targeted, ecosystem-specific interventions that address the dominant drivers of change shaping national ecosystem risk.

## Red List of Ecosystem at the Global Ecosystem Typology by realm

```{r, echo=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(scales)
library(stringr)

plot_rle_bar_wide <- function(data,
                              group_var,
                              levels_vec,
                              y_label = NULL,
                              show_legend = TRUE,
                              caption = NULL,
                              text_size = 8,
                              label_size = 2,
                              wrap_width = 25,
                              bar_width = 0.7) {

  rle_cols <- c(
    "Least Concern",
    "Near Threatened",
    "Vulnerable",
    "Endangered",
    "Critically Endangered"
  )

  df_long <- data %>%
    pivot_longer(
      cols = all_of(rle_cols),
      names_to  = "RLE",
      values_to = "Count"
    ) %>%
    mutate(
      RLE = factor(RLE, levels = rle_cols),
      {{ group_var }} := factor({{ group_var }}, levels = levels_vec)
    ) %>%
    group_by({{ group_var }}) %>%
    mutate(prop = Count / sum(Count)) %>%
    ungroup()

  p <- ggplot(df_long, aes(y = {{ group_var }}, x = prop, fill = RLE)) +
    geom_bar(stat = "identity", position = "fill", width = bar_width) +
    geom_text(aes(label = ifelse(Count == 0, "", Count)),
              position = position_fill(vjust = 0.5),
              size = label_size) +
    scale_x_continuous(breaks = c(0, 0.5, 1),
                       labels = scales::percent_format(accuracy = 1)) +
    scale_fill_manual(values = c("#B4D79E", "grey70", "#FFD966", "#F6B26B", "#CC0000"),
                      name = NULL) +
    scale_y_discrete(labels = function(x) str_wrap(x, wrap_width)) +
    labs(
      x = "Percentage of ecosystem types",
      y = y_label,          # ✅ IMPORTANT
      caption = caption
    ) +
    theme_minimal(base_size = text_size) +
    theme(
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank(),
      panel.grid.minor.x = element_blank(),
      panel.grid.major.x = element_line(color = "grey80", size = 0.04),
      axis.title.x = element_text(size = 6),
      axis.title.y = element_text(size = 6),
      legend.title = element_blank(),
      legend.key.height = unit(0.35, "cm"),
      legend.key.width  = unit(0.35, "cm")
    )

  if (!show_legend) {
    p <- p + theme(legend.position = "none")
  }

  return(p)
}

```


```{r, echo=FALSE}
#| fig.height: 2
#| out.width: 100%
#| 
GET_L2.realm <- plot_rle_bar_wide(GET_L2.count,
                                  group_var  = Realm,
                                  levels_vec = unique(GET_L2.ecosytems_count$Realm),
                                  y_label    = "Realm",
                                   bar_width  = 0.5)

GET_L3.realm <- plot_rle_bar_wide(GET_L3.count,
                                  group_var  = Realm,
                                  levels_vec = unique(GET_L3.ecosytems_count$Realm),
                                  y_label    = "Realm",
                                   bar_width  = 0.5)


# ---- Arrange plots side by side with common legend ----
ggpubr::ggarrange(GET_L2.realm, GET_L3.realm, ncol = 2, labels = c("A", "B"),
  font.label = list(size = 6), common.legend = TRUE, legend = "bottom")


```
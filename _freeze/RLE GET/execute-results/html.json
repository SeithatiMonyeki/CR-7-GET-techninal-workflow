{
  "hash": "4e1f539a802623943b66eed8f2e8bd6c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7th Country Reporting\"\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n#if (!requireNamespace(c(\"magrittr\",\"dplyr\", \"ggplot2\", \"ggthemes\"), quietly = TRUE)) {\n#  install.packages(c(\"magrittr\",\"dplyr\", \"ggplot2\", \"ggthemes\"))\n#}\n\n#devtools::install_github(\"SANBI-NBA/nbaR\", force = T)\n\nlibrary(nbaR)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(rlang)\nlibrary(gt)\nlibrary(ggplot2)\nlibrary(here)\nlibrary(scales)\nlibrary(stringr)\n```\n:::\n\n\n\n::: scrolling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEDD.GET_names <- read.csv(\"./data/EDD_GET levels names.csv\") %>%\n                 mutate(GET_L2.code_text = paste(IUCN_GET_2025_L2, GET_L2.text, sep = \": \")) %>%\n                 mutate(GET_L3.code_text = paste(IUCN_GET_2022_L3, GET_L3.text, sep = \": \")) %>%\n  \n                 group_by(IUCN_GET_2025_L2) %>%\n                 mutate(n.get_L2 = n_distinct(EcosystemType_GETLevel5_6)) %>%\n                 ungroup() %>%\n  \n                 group_by(IUCN_GET_2022_L3) %>%\n                 mutate(n.get_L3 = n_distinct(EcosystemType_GETLevel5_6)) %>%  # or whatever L4 column you want to count\n                 ungroup()  %>%  \n  \n                 mutate(GET_L2.count = paste0(GET_L2.code_text, \" (n = \", n.get_L2, \" ecosystems)\"),\n                        GET_L3.count = paste0(GET_L3.code_text, \" (n = \", n.get_L3, \" ecosystems)\")) %>%\n  \n                 select(Realm_GETL1, Code,`Biome..GET.L3._Ecosystem_Fuctional_Groups..GET.Level.3.`, EcosystemType_GETLevel5_6, RLE_2025, EPL_2025, IUCN_GET_2025_L2, IUCN_GET_2022_L3, GET_L2.count, GET_L3.count) %>%\n\n                 mutate(Realm = case_when(Realm_GETL1 == \"Freshwater_Wetland\" ~ \"Wetland\",\n                                          Realm_GETL1 == \"Freshwater_River\"   ~ \"River\", TRUE ~ Realm_GETL1),\n                        \n                        RLE_2025 = factor(RLE_2025, levels = c(\"LC\", \"NT\", \"VU\", \"EN\", \"CR\"), \n                                                    labels = c(\"Least Concern\", \"Near Threatened\",\"Vulnerable\", \"Endangered\", \"Critically Endangered\")))\n```\n:::\n\n\n:::\n\n::: scrolling\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# First, create a lookup for realm order\nGET_L2.realm_order <- EDD.GET_names %>%\n                      distinct(GET_L2.count, Realm) %>%\n                      mutate(Realm = factor(Realm, levels = c(\"Terrestrial\", \"River\", \"Wetland\", \"Estuarine\", \"Marine\"))) %>%\n                      arrange(Realm, GET_L2.count)\n\nGET_L3.realm_order <- EDD.GET_names %>%\n                      distinct(GET_L3.count, Realm) %>%\n                      mutate(Realm = factor(Realm, levels = c(\"Terrestrial\", \"River\", \"Wetland\", \"Estuarine\", \"Marine\"))) %>%\n                      arrange(Realm, GET_L3.count)\n\n#  -------1.  Number of Ecosystem Types (GET_L5/6) per Threat Status within each IUCN GET 2025 Level 3 -------\n\nGET_L2.RLE <- EDD.GET_names %>%\n              group_by(GET_L2.count, RLE_2025) %>%\n              summarise(n = n_distinct(EcosystemType_GETLevel5_6), .groups = \"drop\") %>%\n              tidyr::pivot_wider(names_from = RLE_2025,\n                                 values_from = n,\n                                 values_fill = 0) %>%\n              mutate(Total = rowSums(select(., -GET_L2.count)))  %>%\n              rowwise() %>%\n              mutate(Threat_total = sum(across(c(`Vulnerable`, `Endangered`, `Critically Endangered`))),\n                     Threat_prc = round((Threat_total/Total) * 100, 0)) %>%\n              ungroup() %>%\n              # Apply the realm-based ordering\n              mutate(GET_L2.count = factor(GET_L2.count, \n                                          levels = GET_L2.realm_order$GET_L2.count)) %>%\n              arrange(GET_L2.count)\n\n#  -------2.  Number of Ecosystem Types (GET_L5/6) per Threat Status within each IUCN GET 2025 Level 3 -------\n\nGET_L3.RLE <- EDD.GET_names %>%\n              group_by(GET_L3.count, RLE_2025) %>%\n              summarise(n = n_distinct(EcosystemType_GETLevel5_6), .groups = \"drop\") %>%\n              tidyr::pivot_wider(names_from = RLE_2025,\n                                 values_from = n,\n                                 values_fill = 0) %>%\n              mutate(Total = rowSums(select(., -GET_L3.count)))  %>%\n              rowwise() %>%\n              mutate(Threat_total = sum(across(c(`Vulnerable`, `Endangered`, `Critically Endangered`))),\n                     Threat_prc = round((Threat_total/Total) * 100, 0)) %>%\n              ungroup() %>%\n              mutate(GET_L3.count = factor(GET_L3.count, \n                                          levels = GET_L3.realm_order$GET_L3.count)) %>%\n              arrange(GET_L3.count)\n\n\nfiles <- list(EDD.GET_biomes = EDD.GET_names,\n              GET_L2.RLE = GET_L2.RLE,\n              GET_L3.RLE = GET_L3.RLE)\n\npurrr::iwalk(files, ~ writexl::write_xlsx(.x, paste0(\"./data/\", .y, \".xlsx\")))\n```\n:::\n\n\n:::\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## \n\n::: scrolling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGET_L2 <- plot_rle_bar_wide(GET_L2.RLE,\n                            group_var  = GET_L2.count,\n                            levels_vec = rev(levels(GET_L2.RLE$GET_L2.count)),\n                            y_label    = \"IUCN Global Ecosystem Typology Level 2\",\n                            bar_width  = 0.5)\nGET_L2\n```\n\n::: {.cell-output-display}\n![](RLE-GET_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nGET_L3 <- plot_rle_bar_wide(GET_L3.RLE,\n                            group_var  = GET_L3.count,\n                            levels_vec = rev(levels(GET_L3.RLE$GET_L3.count)),\n                            y_label    = \"IUCN Global Ecosystem Typology Level 3\",\n                            bar_width  = 0.5)\nGET_L3\n```\n\n::: {.cell-output-display}\n![](RLE-GET_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n:::\n\n",
    "supporting": [
      "RLE-GET_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
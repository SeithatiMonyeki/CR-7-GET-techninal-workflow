{
  "hash": "67448c8805e7d9a282d0af848f18279d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7th Country Reporting\"\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n::: scrolling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEDD.GET_names <- read.csv(\"./data/EDD_GET levels names.csv\") %>%\n                 mutate(GET_L2.code_text = paste(IUCN_GET_2025_L2, GET_L2.text, sep = \": \")) %>%\n                 mutate(GET_L3.code_text = paste(IUCN_GET_2022_L3, GET_L3.text, sep = \": \")) %>%\n                 select(Realm_GETL1, Code, RLE_2025, EPL_2025, GET_L2.code_text, GET_L3.code_text)      \n```\n:::\n\n\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGET_L2.long <- EDD.GET_names %>%\n               group_by(Realm_GETL1, GET_L2.code_text, RLE_2025) %>%\n               summarise(Count = n_distinct(Code),.groups = \"drop\") %>%\n               mutate(Realm = case_when(Realm_GETL1 == \"Freshwater_Wetland\" ~ \"Wetland\",\n                                        Realm_GETL1 == \"Freshwater_River\"   ~ \"River\", TRUE ~ Realm_GETL1)) %>%\n               mutate(RLE_2025 = factor(as.character(RLE_2025),levels = c(\"LC\", \"VU\", \"EN\", \"CR\"), ordered = TRUE)) %>%\n               mutate(RLE.2025 = case_when(RLE_2025 == \"LC\" ~ \"Least Concern\",\n                                           RLE_2025 == \"VU\" ~ \"Vulnerable\",\n                                           RLE_2025 == \"EN\" ~ \"Endangered\", TRUE ~ \"Critically Endangered\"))\n\n\nGET_L3.long <- EDD.GET_names %>%\n               group_by(Realm_GETL1, GET_L3.code_text, RLE_2025) %>%\n               summarise(Count = n_distinct(Code),.groups = \"drop\") %>%\n               mutate(Realm = case_when(Realm_GETL1 == \"Freshwater_Wetland\" ~ \"Wetland\",\n                                        Realm_GETL1 == \"Freshwater_River\"   ~ \"River\", TRUE ~ Realm_GETL1)) %>%\n               mutate(RLE_2025 = factor(as.character(RLE_2025),levels = c(\"LC\", \"VU\", \"EN\", \"CR\"),ordered = TRUE)) %>%\n               mutate(RLE.2025 = case_when(RLE_2025 == \"LC\" ~ \"Least Concern\",\n                                           RLE_2025 == \"VU\" ~ \"Vulnerable\",\n                                           RLE_2025 == \"EN\" ~ \"Endangered\", TRUE ~ \"Critically Endangered\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(grid)\n\nplot_rle_bar <- function(data,\n                         group_var,\n                         rle_var,\n                         count_var,\n                         chart = c(\"percent\", \"count\"),\n                         show  = c(\"percent\", \"count\", \"none\"),\n                         show_legend = TRUE,\n                         caption = NULL,\n                         text_size = 12,\n                         label_size = 14,\n                         wrap_width = 25,\n                         bar_width = 0.7) {\n\n  # ---- ARGUMENT MATCHING ----\n  chart <- match.arg(chart)\n  show  <- match.arg(show)\n\n  # ---- BAR POSITION TYPE ----\n  pos_type <- ifelse(chart == \"percent\", \"fill\", \"stack\")\n\n  # ---- BASE PLOT SETUP ----\n  p <- ggplot(data, aes(y    = {{ group_var }},\n                        x    = {{ count_var }},\n                        fill = factor({{ rle_var }},\n                                      levels = c(\"Least Concern\",\n                                                 \"Vulnerable\",\n                                                 \"Endangered\",\n                                                 \"Critically Endangered\"))))\n\n  # ---- VERTICAL REFERENCE LINES (PERCENT ONLY) ----\n  if (chart == \"percent\") {\n    p <- p + geom_vline(xintercept = c(0, 0.5, 1),\n                        colour = \"grey80\",\n                        linewidth = 0.5)\n  }\n\n  # ---- BAR GEOMETRY ----\n  p <- p + geom_bar(stat     = \"identity\",\n                    position = pos_type,\n                    width    = bar_width)\n\n  # ---- REMOVE GAP BETWEEN BARS ----\n  p <- p + scale_y_discrete(expand = c(0, 0))\n\n  # ---- FILL COLOURS & LEGEND ----\n  p <- p + scale_fill_manual(values = c(\"#B4D79E\", \"yellow\", \"orange\", \"red\"),\n                             name   = \"Threat categories\")\n\n  # ---- AXIS LABELS & CAPTION ----\n  p <- p + labs(x = ifelse(chart == \"percent\",\n                           \"Percentage of ecosystem types\",\n                           \"Count of ecosystem types\"),\n                y = NULL,\n                caption = caption)\n\n  # ---- THEME SETTINGS ----\n  p <- p +\n       theme_minimal() +\n       theme(text               = element_text(size = text_size),\n             legend.key.height  = unit(0.7, \"cm\"),\n             legend.key.width   = unit(0.6, \"cm\"),\n             plot.caption       = element_text(hjust = 0.2,\n                                               size = text_size - 2),\n             panel.grid.major.x = element_blank(),\n             panel.grid.minor.x = element_blank())\n\n  # ---- Y-AXIS LABEL WRAPPING & LEFT ALIGN TEXT ----\n  p <- p +\n       scale_y_discrete(labels = function(x) stringr::str_wrap(x,\n                                                               width = wrap_width)) +\n       theme(axis.text.y = element_text(hjust = 0,\n                                        margin = margin(r = 5)))\n\n  # ---- BAR LABELS ----\n  if (show == \"percent\" && chart == \"percent\") {\n    p <- p + geom_text(aes(label = scales::percent({{ count_var }} / sum({{ count_var }}),\n                                                  accuracy = 1)),\n                       position = position_fill(vjust = 0.5),\n                       size = label_size)\n  } else if (show == \"count\") {\n    p <- p + geom_text(aes(label = {{ count_var }}),\n                       position = position_fill(vjust = 0.5),\n                       size = label_size)\n  }\n\n  # ---- X-AXIS SCALE (PERCENT ONLY) ----\n  if (chart == \"percent\") {\n    p <- p + scale_x_continuous(breaks = c(0, 0.5, 1),\n                                labels = scales::percent_format(accuracy = 1))\n  }\n\n  # ---- SHOW OR HIDE LEGEND ----\n  if (!show_legend) {\n    p <- p + theme(legend.position = \"none\")\n  }\n\n  # ---- RETURN PLOT ----\n  return(p)\n}\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](results_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nGET_L2.wide <- EDD.GET_names %>%\n  group_by(Realm_GETL1, GET_L2.code_text, RLE_2025) %>%\n  summarise(Count = n_distinct(Code), .groups = \"drop\") %>%\n  pivot_wider(\n    names_from = RLE_2025,\n    values_from = Count,\n    values_fill = 0\n  )\nGET_L2.wide\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 13 × 7\n   Realm_GETL1        GET_L2.code_text                CR    EN    LC    VU    NT\n   <chr>              <chr>                        <int> <int> <int> <int> <int>\n 1 Estuarine          FM1: Semi-confined transiti…     2    17     4    20     0\n 2 Freshwater_River   F1: Rivers and streams           1     1     1     1     0\n 3 Freshwater_Wetland F2: Lakes                        1     1     1     1     0\n 4 Freshwater_Wetland TF1: Palustrine wetlands         1     1     1     1     0\n 5 Marine             M1: Marine shelfs                5    14    25    27     8\n 6 Marine             M3: Deep sea floors              0     3    25     0     1\n 7 Marine             MT1: Shoreline systems           0    10     9     7    10\n 8 Terrestrial        MT2: Supralittoral coastal …     4     2     4     0     0\n 9 Terrestrial        T1: Tropical-subtropical fo…     5     0    37     2     0\n10 Terrestrial        T2: Temperate-boreal forest…     0     0     4     0     0\n11 Terrestrial        T3: Shrublands & shrubby wo…    40    28    65     0     0\n12 Terrestrial        T4: Savannas and grasslands      7    35   130     8     0\n13 Terrestrial        T5: Deserts and semi-deserts     7     3    82     0     0\n```\n\n\n:::\n\n```{.r .cell-code}\nGET_L3.wide <- EDD.GET_names %>%\n  group_by(Realm_GETL1, GET_L3.code_text, RLE_2025) %>%\n  summarise(Count = n_distinct(Code), .groups = \"drop\") %>%\n  pivot_wider(\n    names_from = RLE_2025,\n    values_from = Count,\n    values_fill = 0\n  )\n\nGET_L3.wide\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 36 × 7\n   Realm_GETL1        GET_L3.code_text                CR    EN    LC    VU    NT\n   <chr>              <chr>                        <int> <int> <int> <int> <int>\n 1 Estuarine          FM1.2: Permanently open riv…     2    13     2    12     0\n 2 Estuarine          FM1.3: Intermittently close…     0     4     2     8     0\n 3 Freshwater_River   F1.1: Permanent upland stre…     1     1     1     1     0\n 4 Freshwater_River   F1.2: Permanent lowland riv…     1     1     1     1     0\n 5 Freshwater_River   F1.4: Seasonal upland strea…     1     1     1     1     0\n 6 Freshwater_River   F1.5: Seasonal lowland rive…     1     1     1     1     0\n 7 Freshwater_Wetland F2.3: Seasonal freshwater l…     1     1     1     1     0\n 8 Freshwater_Wetland F2.5: Ephemeral freshwater …     1     1     1     1     0\n 9 Freshwater_Wetland TF1.3: Permanent marshes         1     1     1     1     0\n10 Freshwater_Wetland TF1.4: Seasonal floodplain …     0     1     1     1     0\n# ℹ 26 more rows\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n:::\n",
    "supporting": [
      "results_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "c86cad4f62c9df73e5679de621b6ee7b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"7th Country Reporting\"\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n\n::: scrolling\n\n\n::: {.cell}\n\n```{.r .cell-code}\nEDD.GET_names <- read.csv(\"./data/EDD_GET levels names.csv\") %>%\n                 mutate(Realm_GETL1 = case_when(Realm_GETL1 == \"Terrestrial/Freshwater\" ~ \"Terrestrial\", TRUE ~ Realm_GETL1)) %>%\n                 mutate(across(c(IUCN_GET_2025_L2, IUCN_GET_2022_L3, RLE_2025, EPL_2025), ~ case_when(.x %in% c(\"\",\n                                                                                                                \"#N/A\", \n                                                                                                                \"#VALUE!\", \n                                                                                                                \"Not Evaluated\")  ~ NA_character_,\n                                                                                            TRUE ~ .x))) %>%\n       filter(!(is.na(IUCN_GET_2025_L2) | is.na(IUCN_GET_2022_L3) | is.na(RLE_2025))) %>%\n       filter(EPL_2025 %in% c(\"WP\", \"MP\", \"PP\", \"NP\")) %>%\n       mutate(GET_L2.code_text = paste(IUCN_GET_2025_L2, GET_L2.text, sep = \": \")) %>%\n       mutate(GET_L3.code_text = paste(IUCN_GET_2022_L3, GET_L3.text, sep = \": \")) %>%\n       select(Realm_GETL1, Code, RLE_2025, EPL_2025, GET_L2.code_text, GET_L3.code_text)      \n```\n:::\n\n\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nGET_L2.long <- EDD.GET_names %>%\n               group_by(Realm_GETL1, GET_L2.code_text, RLE_2025) %>%\n               summarise(Count = n_distinct(Code),.groups = \"drop\") %>%\n               mutate(RLE_2025 = factor(RLE_2025,levels = c(\"LC\", \"VU\", \"EN\", \"CR\"),\n                                                 labels = c(\"Least Concern\",\n                                                            \"Vulnerable\",\n                                                            \"Endangered\",\n                                                            \"Critically Endangered\")))\n\n\nGET_L3.long <- EDD.GET_names %>%\n               group_by(Realm_GETL1, GET_L3.code_text, RLE_2025) %>%\n               summarise(Count = n_distinct(Code),.groups = \"drop\") %>%\n               mutate(RLE_2025 = factor(RLE_2025,levels = c(\"LC\", \"VU\", \"EN\", \"CR\"),\n                                                 labels = c(\"Least Concern\",\n                                                            \"Vulnerable\",\n                                                            \"Endangered\",\n                                                            \"Critically Endangered\")))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(scales)\nlibrary(grid)\n\nplot_rle_bar <- function(data,\n                         group_var,\n                         rle_var,\n                         count_var,\n                         chart = c(\"percent\", \"count\"),\n                         show  = c(\"percent\", \"count\", \"none\"),\n                         show_legend = TRUE,   # <-- NEW\n                         caption = NULL,\n                         text_size = 30,\n                         label_size = 22,\n                         wrap_width = 25,\n                         bar_width = 0.7) {\n\n  # ---- ARGUMENT MATCHING ----\n  chart <- match.arg(chart)\n  show  <- match.arg(show)\n\n  # ---- BAR POSITION TYPE ----\n  pos_type <- ifelse(chart == \"percent\", \"fill\", \"stack\")\n\n  # ---- BASE PLOT SETUP ----\n  p <- ggplot(data, aes(y    = {{ group_var }},\n                        x    = {{ count_var }},\n                        fill = factor({{ rle_var }},\n                                      levels = c(\"Least Concern\",\n                                                 \"Vulnerable\",\n                                                 \"Endangered\",\n                                                 \"Critically Endangered\"))))\n\n  # ---- VERTICAL REFERENCE LINES (PERCENT ONLY) ----\n  if (chart == \"percent\") {\n    p <- p + geom_vline(xintercept = c(0, 0.5, 1),\n                        colour = \"grey80\",\n                        linewidth = 0.5)\n  }\n\n  # ---- BAR GEOMETRY ----\n  p <- p + geom_bar(stat     = \"identity\",\n                    position = pos_type,\n                    width    = bar_width)\n\n  # ---- FILL COLOURS & LEGEND ----\n  p <- p + scale_fill_manual(values = c(\"#B4D79E\", \"yellow\", \"orange\", \"red\"),\n                             name   = \"Threat categories\")\n\n  # ---- AXIS LABELS & CAPTION ----\n  p <- p + labs(x = ifelse(chart == \"percent\",\n                           \"Percentage of ecosystem types\",\n                           \"Count of ecosystem types\"),\n                y = NULL,\n                caption = caption)\n\n  # ---- THEME SETTINGS ----\n  p <- p +\n       theme_minimal() +\n       theme(text               = element_text(size = text_size),\n             legend.key.height  = unit(0.7, \"cm\"),\n             legend.key.width   = unit(0.6, \"cm\"),\n             plot.caption       = element_text(hjust = 0.2,\n                                               size = text_size - 2),\n             panel.grid.major.x = element_blank(),\n             panel.grid.minor.x = element_blank())\n\n  # ---- Y-AXIS LABEL WRAPPING & LEFT ALIGN TEXT ----\n  p <- p +\n       scale_y_discrete(labels = function(x) stringr::str_wrap(x,\n                                                               width = wrap_width)) +\n       theme(axis.text.y = element_text(hjust = 0,\n                                        margin = margin(r = 5)))\n\n  # ---- BAR LABELS ----\n  if (show == \"percent\" && chart == \"percent\") {\n    p <- p + geom_text(aes(label = scales::percent({{ count_var }} / sum({{ count_var }}),\n                                                  accuracy = 1)),\n                       position = position_fill(vjust = 0.5),\n                       size = label_size)\n  } else if (show == \"count\") {\n    p <- p + geom_text(aes(label = {{ count_var }}),\n                       position = position_fill(vjust = 0.5),\n                       size = label_size)\n  }\n\n  # ---- X-AXIS SCALE (PERCENT ONLY) ----\n  if (chart == \"percent\") {\n    p <- p + scale_x_continuous(breaks = c(0, 0.5, 1),\n                                labels = scales::percent_format(accuracy = 1))\n  }\n\n  # ---- SHOW OR HIDE LEGEND ----\n  if (!show_legend) {\n    p <- p + theme(legend.position = \"none\")\n  }\n\n  # ---- RETURN PLOT ----\n  return(p)\n}\n```\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=3840}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}